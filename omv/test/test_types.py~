import glob
from os.path import splitext, basename, normpath

def walk_testdir(root, validator):
    for f in glob.glob(root + '/test/*.yaml'):
        print 'found test document', f
        fname = splitext(basename(f))[0]
        try:
            target = fname[:fname.rindex('.')]
        except ValueError:
            target = fname

        schema_src = normpath(''.join([root, '/', target , '.yaml']))
        print 'using schema', schema_src
        assert validator.validate(schema_src, f)
        print 'valid!\n'

def test_base():
    from rx_validator import RXSchemaValidator as v
    walk_testdir('./types/base', v())
        

def test_derived():
    from validate_mep import OSBMEP as o
    walk_testdir('./types', o())


















